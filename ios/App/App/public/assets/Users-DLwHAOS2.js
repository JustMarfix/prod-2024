import{h as M,j as i,k as a,l as g,m as t,D as f,p as $,v as C,F as b,I as _,y as l,x as w,r as S,e as B,J as j,o as D,u as x,C as z}from"./index-Cxdx-ytl.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";function U(e){switch(e){case"viewer":return"Зритель";case"reviewer":return"Проверящий";case"editor":return"Редактор";case"admin":return"Администратор";case"owner":return"Владелец"}}const P=M({name:"ModalAddUser",props:{isShown:Boolean,closeModal:Function,id:String,initialUser:Object},data(){var e,s,r;return{permissions:((e=this.$props.initialUser)==null?void 0:e.rights)||["viewer"],login:(r=(s=this.$props.initialUser)==null?void 0:s.user)==null?void 0:r.login,rights:["viewer","editor","reviewer"],mystore:null}},beforeMount(){this.mystore=l},mounted(){console.log(this.mystore.auth.permissions.some(e=>e.name==="owner")),this.mystore.auth.permissions.some(e=>e.name==="owner")&&this.rights.push("admin")},methods:{convertMyPerm(e){return U(e)},isChecked(e){return this.permissions.find(s=>s===e||s.name===e)},async deleteUser(){w.deleteUser(this.id,this.login).then(()=>{l.data.users=[...l.data.users].filter(({user:e})=>e.login!==this.login)}).finally(()=>{this.closeModal()})},async addUser(){var e,s;if((s=(e=this.$props.initialUser)==null?void 0:e.user)!=null&&s.login){console.log(this.permissions),await w.updateUser(this.id,{login:this.login,permissions:this.permissions.map(r=>(r==null?void 0:r.name)||r)}).then(r=>{const n=[...l.data.users],p=n.findIndex(({user:y})=>y.login===this.login);n[p]={...r,rights:this.permissions},l.data.users=n}).finally(()=>{this.closeModal()});return}w.inviteUser(this.id,{login:this.login,permissions:this.permissions.map(r=>(r==null?void 0:r.name)||r)}).then(r=>{l.data.users=[...l.data.users,{...r,rights:this.permissions.map(n=>(n==null?void 0:n.name)||n)}]}).finally(()=>{this.closeModal()})}}}),V={key:1,class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50"},A={class:"relative p-4 w-full max-w-md max-h-full top-0 right-0 left-0 z-50"},E={class:"relative bg-white rounded-lg shadow dark:bg-gray-700 min-w-80"},I={class:"flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600"},N={class:"text-lg font-semibold text-gray-900 dark:text-white"},q=t("svg",{class:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"},[t("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})],-1),J=t("span",{class:"sr-only"},"Close modal",-1),L=[q,J],O=["onsubmit"],T={class:"grid gap-4 mb-4 grid-cols-2"},G={class:"col-span-2"},H=t("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Логин",-1),K=["disabled"],Q=["id","onchange","disabled","checked"],R=["for"],W=["disabled"];function X(e,s,r,n,p,y){var h,d,c,u,k;return i(),a(b,null,[e.isShown?(i(),a("div",{key:0,onClick:s[0]||(s[0]=(...o)=>e.closeModal&&e.closeModal(...o)),class:"top-0 left-0 h-screen w-screen bg-gray-900 fixed opacity-20 z-40"})):g("",!0),e.isShown?(i(),a("div",V,[t("div",A,[t("div",E,[t("div",I,[t("h3",N,f((h=this.$props.initialUser.user)!=null&&h.name?"Редактировать пользоваетля":"Добавить пользователя"),1),t("button",{onClick:s[1]||(s[1]=(...o)=>e.closeModal&&e.closeModal(...o)),type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white","data-modal-toggle":"crud-modal"},L)]),t("form",{onsubmit:o=>o.preventDefault(),class:"p-4 md:p-5"},[t("div",T,[t("div",G,[H,$(t("input",{disabled:(c=(d=this.$props.initialUser)==null?void 0:d.user)==null?void 0:c.name,type:"text",name:"name",id:"name","onUpdate:modelValue":s[2]||(s[2]=o=>e.login=o),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Логин пользователя",required:""},null,8,K),[[C,e.login]])])]),(i(!0),a(b,null,_(e.rights,o=>(i(),a("div",{key:o,class:"flex items-center mb-4"},[t("input",{id:o,type:"checkbox",onchange:v=>{v.target.checked?this.permissions=[...e.permissions,o]:this.permissions=e.permissions.map(m=>(m==null?void 0:m.name)||m).filter(m=>m!==o)},disabled:o==="viewer",checked:e.isChecked(o),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,8,Q),t("label",{for:o,class:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"},f(e.convertMyPerm(o)),9,R)]))),128)),t("button",{onClick:s[3]||(s[3]=(...o)=>e.addUser&&e.addUser(...o)),disabled:!e.login,class:"text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},f((u=this.$props.initialUser.user)!=null&&u.name?"Редактировать пользоваетля":"Добавить пользователя"),9,W),(k=this.$props.initialUser.user)!=null&&k.name?(i(),a("button",{key:0,onClick:s[4]||(s[4]=(...o)=>e.deleteUser&&e.deleteUser(...o)),class:"text-white inline-flex items-center bg-red-500 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 mt-2 py-2.5"}," Выгони пользователя ")):g("",!0)],8,O)])])])):g("",!0)],64)}const Y=F(P,[["render",X]]),Z={class:"flex flex-col px-4 mt-20 w-full"},ee={class:"grid md:grid-cols-3 sm:grid-cols-2 gap-2 w-full"},se={class:"flex flex-col h-full"},te={class:"flex justify-between"},oe={class:"text-lg font-semibold text-gray-900 dark:text-white"},re={class:"text-lg mb-2 font-semibold text-gray-500 dark:text-neutral-400"},ie={class:"flex flex-wrap mb-4"},ne=["onClick"],ae={key:1,class:"text-lg mt-auto font-semibold text-blue-400 dark:text-white"},ue={__name:"Users",props:{id:{type:String,default:"1"}},setup(e){const s=S(),r=B(()=>d=>l.auth.id!==d.user.id&&d.rights.some(c=>c.name!=="admin"&&c.name!=="owner")||l.auth.permissions.some(c=>c.name==="owner")&&l.auth.id!==d.user.id);console.log(r);const n=j({targetUser:{}});function p(d){s.value?(n.targetUser={},s.value=!1):(d&&(n.targetUser=d),s.value=!0)}function y(){s.value=!1}const h=e;return D(()=>{w.getUsers(h.id).then(d=>{l.data.users=d.users})}),(d,c)=>(i(),a(b,null,[t("div",Z,[t("button",{onClick:p,class:"block mb-3 w-60 max-w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"}," Пригласить в организацию "),t("div",ee,[(i(!0),a(b,null,_(x(l).data.users,(u,k)=>(i(),a("div",{key:k,class:"w-full flex flex-col p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700"},[t("div",se,[t("div",te,[t("h3",oe,f(u.user.name),1),t("h3",re,f(u.user.id),1)]),t("div",ie,[(i(!0),a(b,null,_(u.rights,(o,v)=>(i(),a("h3",{class:"text-md mx-2 font-normal text-gray-900 dark:text-white",key:v},f(x(U)(o.name)||x(U)(o)),1))),128))]),r.value(u)?(i(),a("button",{key:0,onClick:()=>p(u),class:"block mt-auto text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"}," Редактировать ",8,ne)):g("",!0),x(l).auth.id===u.user.id?(i(),a("div",ae," Это вы! ")):g("",!0)])]))),128))])]),s.value?(i(),z(Y,{key:0,isShown:s.value,closeModal:y,id:h.id,"initial-user":n.targetUser},null,8,["isShown","id","initial-user"])):g("",!0)],64))}};export{ue as default};
